{
  "hash": "b1aa85978b6df0ee8f40f206e90ecb60",
  "result": {
    "markdown": "---\ntitle: \"Regression Discontinuity\"\nauthor: \"Shashidhar Cheeti\"\n---\n\n::: {.cell hash='10_rdd_cache/html/unnamed-chunk-1_cb9f18ee816e527354cd51ed1a21299f'}\n\n```{.r .cell-code}\nlibrary(tidyverse)\n```\n\n::: {.cell-output .cell-output-stderr}\n```\n#> ── Attaching core tidyverse packages ──────────────────────── tidyverse 2.0.0 ──\n#> ✔ dplyr     1.1.4     ✔ readr     2.1.4\n#> ✔ forcats   1.0.0     ✔ stringr   1.5.0\n#> ✔ ggplot2   3.4.4     ✔ tibble    3.2.1\n#> ✔ lubridate 1.9.3     ✔ tidyr     1.3.0\n#> ✔ purrr     1.0.2     \n#> ── Conflicts ────────────────────────────────────────── tidyverse_conflicts() ──\n#> ✖ dplyr::filter() masks stats::filter()\n#> ✖ dplyr::lag()    masks stats::lag()\n#> ℹ Use the conflicted package (<http://conflicted.r-lib.org/>) to force all conflicts to become errors\n```\n:::\n\n```{.r .cell-code}\nlibrary(dplyr)\nlibrary(ggdag)\n```\n\n::: {.cell-output .cell-output-stderr}\n```\n#> \n#> Attaching package: 'ggdag'\n#> \n#> The following object is masked from 'package:stats':\n#> \n#>     filter\n```\n:::\n\n```{.r .cell-code}\nlibrary(dagitty)\n```\n:::\n\n::: {.cell hash='10_rdd_cache/html/unnamed-chunk-2_b555e7a946a4850039446f8e0795399a'}\n\n```{.r .cell-code}\n# Load the file\ncoupon<- readRDS(\"Causal_Data_Science_Data/coupon.rds\")\n# Create a Data Frame\ndf=data.frame(coupon)\n```\n:::\n\n::: {.cell hash='10_rdd_cache/html/unnamed-chunk-3_e4f24057d7be8e6d302c563a2b596a08'}\n\n```{.r .cell-code}\n# Define cut-off\nc0 = 60\n# Half bandwidth\nbw <- c0 + c(-2.5, 2.5)\n\n# Subsets below and above threshold in specified bandwidth\ndf_bw_below <- df %>% filter(days_since_last %>% between(bw[1], c0-1e-4))\ndf_bw_above <- df %>% filter(days_since_last %>% between(c0, bw[2]))\n\n# Alternative way to define tables\n# df_bw_below <- df %>% filter(days_since_last >= bw[1], days_since_last  < c0)\n# df_bw_above <- df %>% filter(days_since_last >= c0, days_since_last <= bw[2])\n\ndf_bw <- bind_rows(df_bw_above, df_bw_below)\ndim(df_bw)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n#> [1] 181   4\n```\n:::\n:::\n\n::: {.cell hash='10_rdd_cache/html/unnamed-chunk-4_96fe67253c2e06785da7559069410a89'}\n\n```{.r .cell-code}\n# Define cut-off\nc0 = 60\n# Double bandwidth\nbw <- c0 + c(-10, 10)\n\n# Subsets below and above threshold in specified bandwidth\ndf_bw_below <- df %>% filter(days_since_last %>% between(bw[1], c0-1e-4))\ndf_bw_above <- df %>% filter(days_since_last %>% between(c0, bw[2]))\n\n# Alternative way to define tables\n# df_bw_below <- df %>% filter(days_since_last >= bw[1], days_since_last  < c0)\n# df_bw_above <- df %>% filter(days_since_last >= c0, days_since_last <= bw[2])\n\ndf_bw <- bind_rows(df_bw_above, df_bw_below)\ndim(df_bw)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n#> [1] 629   4\n```\n:::\n:::\n\n::: {.cell hash='10_rdd_cache/html/unnamed-chunk-5_d92c5706e51c1e4ac3d273c34b9bc9d6'}\n\n```{.r .cell-code}\n# Load the file\nshipping<- readRDS(\"Causal_Data_Science_Data/shipping.rds\")\n# Create a Data Frame\ndf2=data.frame(shipping)\n```\n:::\n\n::: {.cell hash='10_rdd_cache/html/unnamed-chunk-6_510c9a1749180bca8ea747c27efb4a55'}\n\n```{.r .cell-code}\n# Density test\n# Check for continuous density along running variable. Manipulations could \n# lead to running variable being \"crowded\" right after cutoff.\nlibrary(rddensity)\nrddd <- rddensity(df2$purchase_amount, c = 30)\nsummary(rddd)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n#> \n#> Manipulation testing using local polynomial density estimation.\n#> \n#> Number of obs =       6666\n#> Model =               unrestricted\n#> Kernel =              triangular\n#> BW method =           estimated\n#> VCE method =          jackknife\n#> \n#> c = 30                Left of c           Right of c          \n#> Number of obs         3088                3578                \n#> Eff. Number of obs    2221                1955                \n#> Order est. (p)        2                   2                   \n#> Order bias (q)        3                   3                   \n#> BW est. (h)           22.909              20.394              \n#> \n#> Method                T                   P > |T|             \n#> Robust                5.9855              0\n```\n:::\n\n::: {.cell-output .cell-output-stderr}\n```\n#> Warning in summary.CJMrddensity(rddd): There are repeated observations. Point\n#> estimates and standard errors have been adjusted. Use option massPoints=FALSE\n#> to suppress this feature.\n```\n:::\n\n::: {.cell-output .cell-output-stdout}\n```\n#> \n#> P-values of binomial tests (H0: p=0.5).\n#> \n#> Window Length / 2          <c     >=c    P>|T|\n#> 0.261                      20      26    0.4614\n#> 0.522                      41      65    0.0250\n#> 0.783                      62     107    0.0007\n#> 1.043                      81     136    0.0002\n#> 1.304                     100     169    0.0000\n#> 1.565                     114     196    0.0000\n#> 1.826                     132     227    0.0000\n#> 2.087                     156     263    0.0000\n#> 2.348                     173     298    0.0000\n#> 2.609                     191     331    0.0000\n```\n:::\n:::\n\n::: {.cell hash='10_rdd_cache/html/unnamed-chunk-7_f70982e29303a353b1071cc6442c8f75'}\n\n```{.r .cell-code}\n# Visually check continuity at running variable\nrdd_plot <- rdplotdensity(rddd, df2$purchase_amount, plotN = 100)\n```\n\n::: {.cell-output-display}\n![](10_rdd_files/figure-html/unnamed-chunk-7-1.png){width=672}\n:::\n:::\n\n\nThe plot confirms as they did not overlap, we would have to suspect some kind of manipulation around the cut-off and could not use RDD to obtain valid results.\n\n",
    "supporting": [],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {
      "include-in-header": [
        "<link href=\"../../site_libs/pagedtable-1.1/css/pagedtable.css\" rel=\"stylesheet\" />\n<script src=\"../../site_libs/pagedtable-1.1/js/pagedtable.js\"></script>\n"
      ]
    },
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}