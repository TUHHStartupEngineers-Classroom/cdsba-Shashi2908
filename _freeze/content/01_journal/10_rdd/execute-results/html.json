{
  "hash": "4539330348cf8668660a0297b205e874",
  "result": {
    "markdown": "---\ntitle: \"Regression Discontinuity\"\n---\n\n::: {.cell hash='10_rdd_cache/html/unnamed-chunk-1_cb9f18ee816e527354cd51ed1a21299f'}\n\n```{.r .cell-code}\nlibrary(tidyverse)\n```\n\n::: {.cell-output .cell-output-stderr}\n```\n#> ── Attaching core tidyverse packages ──────────────────────── tidyverse 2.0.0 ──\n#> ✔ dplyr     1.1.4     ✔ readr     2.1.4\n#> ✔ forcats   1.0.0     ✔ stringr   1.5.0\n#> ✔ ggplot2   3.4.4     ✔ tibble    3.2.1\n#> ✔ lubridate 1.9.3     ✔ tidyr     1.3.0\n#> ✔ purrr     1.0.2     \n#> ── Conflicts ────────────────────────────────────────── tidyverse_conflicts() ──\n#> ✖ dplyr::filter() masks stats::filter()\n#> ✖ dplyr::lag()    masks stats::lag()\n#> ℹ Use the conflicted package (<http://conflicted.r-lib.org/>) to force all conflicts to become errors\n```\n:::\n\n```{.r .cell-code}\nlibrary(dplyr)\nlibrary(ggdag)\n```\n\n::: {.cell-output .cell-output-stderr}\n```\n#> \n#> Attaching package: 'ggdag'\n#> \n#> The following object is masked from 'package:stats':\n#> \n#>     filter\n```\n:::\n\n```{.r .cell-code}\nlibrary(dagitty)\n```\n:::\n\n::: {.cell hash='10_rdd_cache/html/unnamed-chunk-2_8d9d1d2762c90bf9b54de04d2317e40b'}\n\n```{.r .cell-code}\n# Load the file\ncoupon<- readRDS(\"Causal_Data_Science_Data/coupon.rds\")\n# Create a Data Frame\ndf=data.frame(coupon)\nhead(df)\n```\n\n::: {.cell-output-display}\n`````{=html}\n<div data-pagedtable=\"false\">\n  <script data-pagedtable-source type=\"application/json\">\n{\"columns\":[{\"label\":[\"\"],\"name\":[\"_rn_\"],\"type\":[\"\"],\"align\":[\"left\"]},{\"label\":[\"days_since_last\"],\"name\":[1],\"type\":[\"dbl\"],\"align\":[\"right\"]},{\"label\":[\"days_since_last_centered\"],\"name\":[2],\"type\":[\"dbl\"],\"align\":[\"right\"]},{\"label\":[\"coupon\"],\"name\":[3],\"type\":[\"lgl\"],\"align\":[\"right\"]},{\"label\":[\"purchase_after\"],\"name\":[4],\"type\":[\"dbl\"],\"align\":[\"right\"]}],\"data\":[{\"1\":\"82.0\",\"2\":\"22.0\",\"3\":\"TRUE\",\"4\":\"22.821321\",\"_rn_\":\"1\"},{\"1\":\"39.0\",\"2\":\"-21.0\",\"3\":\"FALSE\",\"4\":\"11.583787\",\"_rn_\":\"2\"},{\"1\":\"7.2\",\"2\":\"-52.8\",\"3\":\"FALSE\",\"4\":\"15.982824\",\"_rn_\":\"3\"},{\"1\":\"115.6\",\"2\":\"55.6\",\"3\":\"TRUE\",\"4\":\"20.458175\",\"_rn_\":\"4\"},{\"1\":\"17.0\",\"2\":\"-43.0\",\"3\":\"FALSE\",\"4\":\"8.904734\",\"_rn_\":\"5\"},{\"1\":\"42.8\",\"2\":\"-17.2\",\"3\":\"FALSE\",\"4\":\"6.723591\",\"_rn_\":\"6\"}],\"options\":{\"columns\":{\"min\":{},\"max\":[10]},\"rows\":{\"min\":[10],\"max\":[10]},\"pages\":{}}}\n  </script>\n</div>\n`````\n:::\n\n```{.r .cell-code}\nglimpse(df)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n#> Rows: 5,000\n#> Columns: 4\n#> $ days_since_last          <dbl> 82.0, 39.0, 7.2, 115.6, 17.0, 42.8, 62.2, 55.…\n#> $ days_since_last_centered <dbl> 22.0, -21.0, -52.8, 55.6, -43.0, -17.2, 2.2, …\n#> $ coupon                   <lgl> TRUE, FALSE, FALSE, TRUE, FALSE, FALSE, TRUE,…\n#> $ purchase_after           <dbl> 22.821321, 11.583787, 15.982824, 20.458175, 8…\n```\n:::\n:::\n\n::: {.cell hash='10_rdd_cache/html/unnamed-chunk-3_c1486fc6c55d91f0b2d05b9e52b28223'}\n\n```{.r .cell-code}\nc0 = 60\nbw <- c0 + c(-2.5, 2.5)\n\n# Subsets below and above threshold in specified bandwidth\ndf_bw_below <- df %>% filter(days_since_last >= bw[1] & days_since_last < c0)\ndf_bw_above <- df %>% filter(days_since_last >= c0 & days_since_last <= bw[2])\n\n# Alternative way to define tables\n# df_bw_below <- df %>% filter(days_since_last >= bw[1], days_since_last  < c0)\n# df_bw_above <- df %>% filter(days_since_last >= c0, days_since_last <= bw[2])\n\ndf_bw <- bind_rows(df_bw_above, df_bw_below)\ndim(df_bw)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n#> [1] 181   4\n```\n:::\n:::\n\n::: {.cell hash='10_rdd_cache/html/unnamed-chunk-4_bf686b69b9d5ca84d01ec85b42c175f8'}\n\n```{.r .cell-code}\nc0 = 60\nbw <- c0 + c(-10, 10)\n\n# Subsets below and above threshold in specified bandwidth\ndf_bw_below <- df %>% filter(days_since_last >= bw[1] & days_since_last < c0)\ndf_bw_above <- df %>% filter(days_since_last >= c0 & days_since_last <= bw[2])\n\n# Alternative way to define tables\n# df_bw_below <- df %>% filter(days_since_last >= bw[1], days_since_last  < c0)\n# df_bw_above <- df %>% filter(days_since_last >= c0, days_since_last <= bw[2])\n\ndf_bw <- bind_rows(df_bw_above, df_bw_below)\ndim(df_bw)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n#> [1] 629   4\n```\n:::\n:::\n\n::: {.cell hash='10_rdd_cache/html/unnamed-chunk-5_c8b16638f55e9b8b6e5131a593f67152'}\n\n```{.r .cell-code}\n# Density test\n# Check for continuous density along running variable. Manipulations could \n# lead to running variable being \"crowded\" right after cutoff.\nlibrary(rddensity)\nrddd <- rddensity(df$days_since_last, c = 30)\nsummary(rddd)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n#> \n#> Manipulation testing using local polynomial density estimation.\n#> \n#> Number of obs =       5000\n#> Model =               unrestricted\n#> Kernel =              triangular\n#> BW method =           estimated\n#> VCE method =          jackknife\n#> \n#> c = 30                Left of c           Right of c          \n#> Number of obs         2460                2540                \n#> Eff. Number of obs    1340                1061                \n#> Order est. (p)        2                   2                   \n#> Order bias (q)        3                   3                   \n#> BW est. (h)           17.337              20.341              \n#> \n#> Method                T                   P > |T|             \n#> Robust                -0.6308             0.5282\n```\n:::\n\n::: {.cell-output .cell-output-stderr}\n```\n#> Warning in summary.CJMrddensity(rddd): There are repeated observations. Point\n#> estimates and standard errors have been adjusted. Use option massPoints=FALSE\n#> to suppress this feature.\n```\n:::\n\n::: {.cell-output .cell-output-stdout}\n```\n#> \n#> P-values of binomial tests (H0: p=0.5).\n#> \n#> Window Length / 2          <c     >=c    P>|T|\n#> 0.200                      23      20    0.7608\n#> 0.400                      34      28    0.5258\n#> 0.600                      38      35    0.8151\n#> 0.800                      59      47    0.2853\n#> 1.000                      69      58    0.3750\n#> 1.200                      85      68    0.1957\n#> 1.400                      97      78    0.1734\n#> 1.600                     111      86    0.0870\n#> 1.800                     119      98    0.1744\n#> 2.000                     125     112    0.4358\n```\n:::\n:::\n\n::: {.cell hash='10_rdd_cache/html/unnamed-chunk-6_bfe544e7643016feef9ef9087fea8d3a'}\n\n```{.r .cell-code}\n# Visually check continuity at running variable\nrdd_plot <- rdplotdensity(rddd, df$days_since_last, plotN = 100)\n```\n\n::: {.cell-output-display}\n![](10_rdd_files/figure-html/unnamed-chunk-6-1.png){width=672}\n:::\n:::\n",
    "supporting": [],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {
      "include-in-header": [
        "<link href=\"../../site_libs/pagedtable-1.1/css/pagedtable.css\" rel=\"stylesheet\" />\n<script src=\"../../site_libs/pagedtable-1.1/js/pagedtable.js\"></script>\n"
      ]
    },
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}