{
  "hash": "b1fb7fe45106964402761b755832dba2",
  "result": {
    "markdown": "---\ntitle: \"Difference-in-Differences\"\n---\n\n::: {.cell hash='08_did_cache/html/unnamed-chunk-1_d161fb0a60b9f3cac6ca084ae6d79e1b'}\n\n```{.r .cell-code}\nlibrary(tidyverse)\n```\n\n::: {.cell-output .cell-output-stderr}\n```\n#> ── Attaching core tidyverse packages ──────────────────────── tidyverse 2.0.0 ──\n#> ✔ dplyr     1.1.4     ✔ readr     2.1.4\n#> ✔ forcats   1.0.0     ✔ stringr   1.5.0\n#> ✔ ggplot2   3.4.4     ✔ tibble    3.2.1\n#> ✔ lubridate 1.9.3     ✔ tidyr     1.3.0\n#> ✔ purrr     1.0.2     \n#> ── Conflicts ────────────────────────────────────────── tidyverse_conflicts() ──\n#> ✖ dplyr::filter() masks stats::filter()\n#> ✖ dplyr::lag()    masks stats::lag()\n#> ℹ Use the conflicted package (<http://conflicted.r-lib.org/>) to force all conflicts to become errors\n```\n:::\n\n```{.r .cell-code}\nlibrary(dplyr)\n```\n:::\n\n::: {.cell hash='08_did_cache/html/unnamed-chunk-2_a3a7b1db1e612763a18a07e5b57b688f'}\n\n```{.r .cell-code}\n# Load the file\nhospdd <- readRDS(\"Causal_Data_Science_Data/hospdd.rds\")\n# Create a Data Frame\ndf=data.frame(hospdd)\nhead(df)\n```\n\n::: {.cell-output-display}\n`````{=html}\n<div data-pagedtable=\"false\">\n  <script data-pagedtable-source type=\"application/json\">\n{\"columns\":[{\"label\":[\"\"],\"name\":[\"_rn_\"],\"type\":[\"\"],\"align\":[\"left\"]},{\"label\":[\"hospital\"],\"name\":[1],\"type\":[\"dbl\"],\"align\":[\"right\"]},{\"label\":[\"frequency\"],\"name\":[2],\"type\":[\"dbl\"],\"align\":[\"right\"]},{\"label\":[\"month\"],\"name\":[3],\"type\":[\"dbl\"],\"align\":[\"right\"]},{\"label\":[\"procedure\"],\"name\":[4],\"type\":[\"dbl\"],\"align\":[\"right\"]},{\"label\":[\"satis\"],\"name\":[5],\"type\":[\"dbl\"],\"align\":[\"right\"]}],\"data\":[{\"1\":\"1\",\"2\":\"3\",\"3\":\"7\",\"4\":\"1\",\"5\":\"4.106527\",\"_rn_\":\"1\"},{\"1\":\"1\",\"2\":\"2\",\"3\":\"3\",\"4\":\"0\",\"5\":\"3.319475\",\"_rn_\":\"2\"},{\"1\":\"1\",\"2\":\"4\",\"3\":\"2\",\"4\":\"0\",\"5\":\"3.411720\",\"_rn_\":\"3\"},{\"1\":\"1\",\"2\":\"2\",\"3\":\"4\",\"4\":\"1\",\"5\":\"3.004025\",\"_rn_\":\"4\"},{\"1\":\"1\",\"2\":\"1\",\"3\":\"3\",\"4\":\"0\",\"5\":\"3.110720\",\"_rn_\":\"5\"},{\"1\":\"1\",\"2\":\"1\",\"3\":\"7\",\"4\":\"1\",\"5\":\"2.882164\",\"_rn_\":\"6\"}],\"options\":{\"columns\":{\"min\":{},\"max\":[10]},\"rows\":{\"min\":[10],\"max\":[10]},\"pages\":{}}}\n  </script>\n</div>\n`````\n:::\n\n```{.r .cell-code}\nglimpse(df)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n#> Rows: 7,368\n#> Columns: 5\n#> $ hospital  <dbl> 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, …\n#> $ frequency <int> 3, 2, 4, 2, 1, 1, 2, 4, 2, 2, 4, 1, 2, 3, 4, 2, 1, 2, 4, 2, …\n#> $ month     <int> 7, 3, 2, 4, 3, 7, 4, 1, 3, 1, 1, 4, 6, 1, 1, 4, 1, 2, 4, 6, …\n#> $ procedure <dbl> 1, 0, 0, 1, 0, 1, 1, 0, 0, 0, 0, 1, 1, 0, 0, 1, 0, 0, 1, 1, …\n#> $ satis     <dbl> 4.106527, 3.319475, 3.411720, 3.004025, 3.110720, 2.882164, …\n```\n:::\n:::\n\n::: {.cell hash='08_did_cache/html/unnamed-chunk-3_83afd816181951edc402c70c92ebcfe8'}\n\n```{.r .cell-code}\n# Convert month to a numeric variable\ndf$month <- as.numeric(as.character(df$month))\n# Create a binary indicator for the post-treatment period\ndf$post_treatment <- ifelse(df$month >= 4, 1, 0)  # Assuming treatment occurred after month 3\n# Function to calculate mean manually\ncalculate_manual_mean <- function(x) {\n  if (length(x) == 0) {\n    return(NA)  # Return NA if there are no observations\n  }\n  sum_value <- sum(x)\n  count_value <- length(x)\n  return(sum_value / count_value)\n}\n\n# Calculate mean satisfaction for treated and controlled hospitals before  treatment\nmean_satisfaction_treated_before <- df %>%\n  filter(procedure == 1, post_treatment == 0) %>%\n  pull(satis) %>%\n  calculate_manual_mean()\n\nmean_satisfaction_treated_after <- df %>%\n  filter(procedure == 1, post_treatment == 1) %>%\n  pull(satis) %>%\n  calculate_manual_mean()\n\n# Calculate mean satisfaction for control hospitals before and after the treatment\nmean_satisfaction_control_before <- df %>%\n  filter(procedure == 0, post_treatment == 0) %>%\n  pull(satis) %>%\n  calculate_manual_mean()\n\nmean_satisfaction_control_after <- df %>%\n  filter(procedure == 0, post_treatment == 1) %>%\n  pull(satis) %>%\n  calculate_manual_mean()\n\n# Print the results\ncat(\"Mean Satisfaction for Treated Hospitals Before Treatment:\", mean_satisfaction_treated_before, \"\\n\")\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n#> Mean Satisfaction for Treated Hospitals Before Treatment: NA\n```\n:::\n\n```{.r .cell-code}\ncat(\"Mean Satisfaction for Treated Hospitals After Treatment:\", mean_satisfaction_treated_after, \"\\n\")\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n#> Mean Satisfaction for Treated Hospitals After Treatment: 4.363351\n```\n:::\n\n```{.r .cell-code}\ncat(\"Mean Satisfaction for Control Hospitals Before Treatment:\", mean_satisfaction_control_before, \"\\n\")\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n#> Mean Satisfaction for Control Hospitals Before Treatment: 3.447765\n```\n:::\n\n```{.r .cell-code}\ncat(\"Mean Satisfaction for Control Hospitals After Treatment:\", mean_satisfaction_control_after, \"\\n\")\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n#> Mean Satisfaction for Control Hospitals After Treatment: 3.38249\n```\n:::\n:::\n\n::: {.cell hash='08_did_cache/html/unnamed-chunk-4_891c03225126c8f79d782ae93805017a'}\n\n```{.r .cell-code}\n# 2.1 Linear regression \nlm_satis <- lm(procedure ~ month + hospital, data = df)\nsummary(lm_satis)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n#> \n#> Call:\n#> lm(formula = procedure ~ month + hospital, data = df)\n#> \n#> Residuals:\n#>      Min       1Q   Median       3Q      Max \n#> -0.56141 -0.23972 -0.04324  0.24191  0.68376 \n#> \n#> Coefficients:\n#>               Estimate Std. Error t value Pr(>|t|)    \n#> (Intercept)  0.2501884  0.0088703   28.20   <2e-16 ***\n#> month        0.0869378  0.0016108   53.97   <2e-16 ***\n#> hospital    -0.0156497  0.0002513  -62.26   <2e-16 ***\n#> ---\n#> Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\n#> \n#> Residual standard error: 0.2928 on 7365 degrees of freedom\n#> Multiple R-squared:  0.4797,\tAdjusted R-squared:  0.4795 \n#> F-statistic:  3395 on 2 and 7365 DF,  p-value: < 2.2e-16\n```\n:::\n:::\n\n::: {.cell hash='08_did_cache/html/unnamed-chunk-5_4097fb2f4ea2f26f0395b16bc8592ea2'}\n\n```{.r .cell-code}\n# 2.2 Linear regression using the factor function\nlm_satis <- lm(procedure ~ as.factor(month) + as.factor(hospital), data = df)\nsummary(lm_satis)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n#> \n#> Call:\n#> lm(formula = procedure ~ as.factor(month) + as.factor(hospital), \n#>     data = df)\n#> \n#> Residuals:\n#>     Min      1Q  Median      3Q     Max \n#> -0.2921 -0.2079  0.0000  0.2079  0.2921 \n#> \n#> Coefficients:\n#>                         Estimate Std. Error t value Pr(>|t|)    \n#> (Intercept)            2.921e-01  1.890e-02   15.45   <2e-16 ***\n#> as.factor(month)2     -5.435e-14  9.981e-03    0.00        1    \n#> as.factor(month)3     -5.076e-15  9.981e-03    0.00        1    \n#> as.factor(month)4      4.159e-01  9.981e-03   41.67   <2e-16 ***\n#> as.factor(month)5      4.159e-01  9.981e-03   41.67   <2e-16 ***\n#> as.factor(month)6      4.159e-01  9.981e-03   41.67   <2e-16 ***\n#> as.factor(month)7      4.159e-01  9.981e-03   41.67   <2e-16 ***\n#> as.factor(hospital)2   2.334e-14  2.639e-02    0.00        1    \n#> as.factor(hospital)3   2.082e-15  2.711e-02    0.00        1    \n#> as.factor(hospital)4   1.161e-14  2.526e-02    0.00        1    \n#> as.factor(hospital)5   1.641e-14  2.526e-02    0.00        1    \n#> as.factor(hospital)6   1.329e-14  2.526e-02    0.00        1    \n#> as.factor(hospital)7  -3.935e-15  2.441e-02    0.00        1    \n#> as.factor(hospital)8   2.745e-14  2.608e-02    0.00        1    \n#> as.factor(hospital)9  -3.100e-14  2.673e-02    0.00        1    \n#> as.factor(hospital)10  1.275e-14  2.639e-02    0.00        1    \n#> as.factor(hospital)11 -9.250e-15  2.608e-02    0.00        1    \n#> as.factor(hospital)12  3.702e-14  2.673e-02    0.00        1    \n#> as.factor(hospital)13 -1.529e-14  2.578e-02    0.00        1    \n#> as.factor(hospital)14 -4.284e-14  2.711e-02    0.00        1    \n#> as.factor(hospital)15 -2.265e-14  2.711e-02    0.00        1    \n#> as.factor(hospital)16  2.440e-14  2.639e-02    0.00        1    \n#> as.factor(hospital)17  2.345e-14  2.752e-02    0.00        1    \n#> as.factor(hospital)18 -1.045e-14  3.205e-02    0.00        1    \n#> as.factor(hospital)19 -5.000e-01  2.711e-02  -18.45   <2e-16 ***\n#> as.factor(hospital)20 -5.000e-01  2.639e-02  -18.95   <2e-16 ***\n#> as.factor(hospital)21 -5.000e-01  2.797e-02  -17.88   <2e-16 ***\n#> as.factor(hospital)22 -5.000e-01  2.752e-02  -18.17   <2e-16 ***\n#> as.factor(hospital)23 -5.000e-01  2.711e-02  -18.45   <2e-16 ***\n#> as.factor(hospital)24 -5.000e-01  2.902e-02  -17.23   <2e-16 ***\n#> as.factor(hospital)25 -5.000e-01  3.114e-02  -16.06   <2e-16 ***\n#> as.factor(hospital)26 -5.000e-01  2.639e-02  -18.95   <2e-16 ***\n#> as.factor(hospital)27 -5.000e-01  2.551e-02  -19.60   <2e-16 ***\n#> as.factor(hospital)28 -5.000e-01  2.797e-02  -17.88   <2e-16 ***\n#> as.factor(hospital)29 -5.000e-01  2.673e-02  -18.70   <2e-16 ***\n#> as.factor(hospital)30 -5.000e-01  3.205e-02  -15.60   <2e-16 ***\n#> as.factor(hospital)31 -5.000e-01  2.639e-02  -18.95   <2e-16 ***\n#> as.factor(hospital)32 -5.000e-01  2.673e-02  -18.70   <2e-16 ***\n#> as.factor(hospital)33 -5.000e-01  2.639e-02  -18.95   <2e-16 ***\n#> as.factor(hospital)34 -5.000e-01  2.481e-02  -20.15   <2e-16 ***\n#> as.factor(hospital)35 -5.000e-01  2.551e-02  -19.60   <2e-16 ***\n#> as.factor(hospital)36 -5.000e-01  2.578e-02  -19.39   <2e-16 ***\n#> as.factor(hospital)37 -5.000e-01  3.114e-02  -16.06   <2e-16 ***\n#> as.factor(hospital)38 -5.000e-01  2.608e-02  -19.18   <2e-16 ***\n#> as.factor(hospital)39 -5.000e-01  2.752e-02  -18.17   <2e-16 ***\n#> as.factor(hospital)40 -5.000e-01  2.608e-02  -19.18   <2e-16 ***\n#> as.factor(hospital)41 -5.000e-01  2.551e-02  -19.60   <2e-16 ***\n#> as.factor(hospital)42 -5.000e-01  2.846e-02  -17.57   <2e-16 ***\n#> as.factor(hospital)43 -5.000e-01  2.711e-02  -18.45   <2e-16 ***\n#> as.factor(hospital)44 -5.000e-01  3.034e-02  -16.48   <2e-16 ***\n#> as.factor(hospital)45 -5.000e-01  2.551e-02  -19.60   <2e-16 ***\n#> as.factor(hospital)46 -5.000e-01  2.752e-02  -18.17   <2e-16 ***\n#> ---\n#> Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\n#> \n#> Residual standard error: 0.2473 on 7316 degrees of freedom\n#> Multiple R-squared:  0.6313,\tAdjusted R-squared:  0.6287 \n#> F-statistic: 245.6 on 51 and 7316 DF,  p-value: < 2.2e-16\n```\n:::\n:::\n",
    "supporting": [],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {
      "include-in-header": [
        "<link href=\"../../site_libs/pagedtable-1.1/css/pagedtable.css\" rel=\"stylesheet\" />\n<script src=\"../../site_libs/pagedtable-1.1/js/pagedtable.js\"></script>\n"
      ]
    },
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}