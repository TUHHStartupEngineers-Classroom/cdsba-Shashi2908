{
  "hash": "7b50ed3e3d4a72b98df208cba00d22cd",
  "result": {
    "markdown": "---\ntitle: \"Instrumental Variables\"\nauthor: \"Shashidhar Cheeti\"\n---\n\n::: {.cell hash='09_iv_cache/html/unnamed-chunk-1_25621d07a741fedfcdce5f751fe9b3ac'}\n\n```{.r .cell-code}\nlibrary(tidyverse)\nlibrary(dplyr)\nlibrary(ggdag)\nlibrary(dagitty)\nlibrary(ggrepel)\n```\n:::\n\n::: {.cell hash='09_iv_cache/html/unnamed-chunk-2_96dbf9ae30238062e884c8ac0541c4ed'}\n\n```{.r .cell-code}\n# Load the file\nrand_enc <- readRDS(\"Causal_Data_Science_Data/rand_enc.rds\")\n# Create a Data Frame\ndf=data.frame(rand_enc)\n```\n:::\n\n\n1. Plot DAG\n\n::: {.cell hash='09_iv_cache/html/unnamed-chunk-3_c6c5a5752c44fa6ece9deedb030737e8'}\n\n```{.r .cell-code}\nApp_usuage <- dagify(\n  Y ~ D,\n  D ~ Z,\n  coords = list(x = c(D = 0.5, Y = 2, Z = -1),\n                y = c(D = 0, Y = 0, Z = 0)),\n  labels = c(\"D\" = \"used_ftr\",\n             \"Y\" = \"timeSpent\",\n             \"Z\" = \"rand_enc\")\n)\n\nggdag(App_usuage, text = TRUE) +\n  geom_dag_point(color = \"blue\") +\n  geom_dag_text(color = \"white\") +\n  geom_dag_edges(edge_color = \"black\") +\n  geom_dag_label_repel(aes(label = label))\n```\n\n::: {.cell-output-display}\n![](09_iv_files/figure-html/unnamed-chunk-3-1.png){width=672}\n:::\n:::\n\nFrom my understanding of these relationships from DAG, time spent would be the outcome which depends on the used new feature (used_ftr) would be the treatment variable and randomized encouragement trial (rand_enc) would be instrumental variable.\n\n2. Compute the naive, biased estimate.\n\n::: {.cell hash='09_iv_cache/html/unnamed-chunk-4_bef2bd184c7e4d564a4518faf151e30c'}\n\n```{.r .cell-code}\nmodel_biased <- lm(time_spent ~ used_ftr, data = df)\nsummary(model_biased)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n#> \n#> Call:\n#> lm(formula = time_spent ~ used_ftr, data = df)\n#> \n#> Residuals:\n#>      Min       1Q   Median       3Q      Max \n#> -20.4950  -3.5393   0.0158   3.5961  20.5051 \n#> \n#> Coefficients:\n#>             Estimate Std. Error t value Pr(>|t|)    \n#> (Intercept) 18.86993    0.06955   271.3   <2e-16 ***\n#> used_ftr    10.82269    0.10888    99.4   <2e-16 ***\n#> ---\n#> Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\n#> \n#> Residual standard error: 5.351 on 9998 degrees of freedom\n#> Multiple R-squared:  0.497,\tAdjusted R-squared:  0.497 \n#> F-statistic:  9881 on 1 and 9998 DF,  p-value: < 2.2e-16\n```\n:::\n:::\n\n::: {.cell hash='09_iv_cache/html/unnamed-chunk-5_14ae8dfafb2c1d0b4e0ea6663e597ff5'}\n\n```{.r .cell-code}\nmodel_naive <- lm(rand_enc ~ used_ftr, data = df)\nsummary(model_naive)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n#> \n#> Call:\n#> lm(formula = rand_enc ~ used_ftr, data = df)\n#> \n#> Residuals:\n#>     Min      1Q  Median      3Q     Max \n#> -0.6299 -0.4220  0.3701  0.3701  0.5780 \n#> \n#> Coefficients:\n#>             Estimate Std. Error t value Pr(>|t|)    \n#> (Intercept) 0.421959   0.006361   66.33   <2e-16 ***\n#> used_ftr    0.207943   0.009959   20.88   <2e-16 ***\n#> ---\n#> Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\n#> \n#> Residual standard error: 0.4894 on 9998 degrees of freedom\n#> Multiple R-squared:  0.04178,\tAdjusted R-squared:  0.04169 \n#> F-statistic:   436 on 1 and 9998 DF,  p-value: < 2.2e-16\n```\n:::\n:::\n\n\n3.\n\n::: {.cell hash='09_iv_cache/html/unnamed-chunk-6_281e5db6be280da435c3a092e4260e6e'}\n\n```{.r .cell-code}\ncor(df$rand_enc, df$used_ftr)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n#> [1] 0.204411\n```\n:::\n:::\n\nThe positive correlation indicates that users who received the encouragement were more likely to use the new feature.\n\n4. Compute the IV estimate using 2SLS and compare it to the naive estimate\n\n::: {.cell hash='09_iv_cache/html/unnamed-chunk-7_6a55524a62def422b4c8a3a37b41957f'}\n\n```{.r .cell-code}\nlibrary(estimatr)\nmodel_iv <- iv_robust(time_spent ~ used_ftr | rand_enc, data = df)\nsummary(model_iv)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n#> \n#> Call:\n#> iv_robust(formula = time_spent ~ used_ftr | rand_enc, data = df)\n#> \n#> Standard error type:  HC2 \n#> \n#> Coefficients:\n#>             Estimate Std. Error t value  Pr(>|t|) CI Lower CI Upper   DF\n#> (Intercept)   19.312     0.2248   85.89 0.000e+00   18.872    19.75 9998\n#> used_ftr       9.738     0.5353   18.19 8.716e-73    8.689    10.79 9998\n#> \n#> Multiple R-squared:  0.4921 ,\tAdjusted R-squared:  0.492 \n#> F-statistic:   331 on 1 and 9998 DF,  p-value: < 2.2e-16\n```\n:::\n:::\n\n\nOn Computing the IV estimate using 2SLS and comparing it to the naive estimate, the naive estimate for used_ftr (0.207943) seems to be biased downward.\n",
    "supporting": [],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {
      "include-in-header": [
        "<link href=\"../../site_libs/pagedtable-1.1/css/pagedtable.css\" rel=\"stylesheet\" />\n<script src=\"../../site_libs/pagedtable-1.1/js/pagedtable.js\"></script>\n"
      ]
    },
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}