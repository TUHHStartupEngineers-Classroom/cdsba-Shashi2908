{
  "hash": "7fed96766211faf4a271451206602430",
  "result": {
    "markdown": "---\ntitle: \"Instrumental Variables\"\nauthor: \"Shashidhar Cheeti\"\n---\n\n::: {.cell hash='09_iv_cache/html/unnamed-chunk-1_748e85c0d16cea5f6f9ff19e50867045'}\n\n```{.r .cell-code}\nlibrary(tidyverse)\nlibrary(dplyr)\nlibrary(ggdag)\nlibrary(dagitty)\n```\n:::\n\n::: {.cell hash='09_iv_cache/html/unnamed-chunk-2_003d4206882544ff8f4b5bf08f3b517a'}\n\n```{.r .cell-code}\n# Load the file\nrand_enc <- readRDS(\"Causal_Data_Science_Data/rand_enc.rds\")\n# Create a Data Frame\ndf=data.frame(rand_enc)\nhead(df)\n```\n\n::: {.cell-output-display}\n`````{=html}\n<div data-pagedtable=\"false\">\n  <script data-pagedtable-source type=\"application/json\">\n{\"columns\":[{\"label\":[\"\"],\"name\":[\"_rn_\"],\"type\":[\"\"],\"align\":[\"left\"]},{\"label\":[\"rand_enc\"],\"name\":[1],\"type\":[\"int\"],\"align\":[\"right\"]},{\"label\":[\"used_ftr\"],\"name\":[2],\"type\":[\"int\"],\"align\":[\"right\"]},{\"label\":[\"time_spent\"],\"name\":[3],\"type\":[\"dbl\"],\"align\":[\"right\"]}],\"data\":[{\"1\":\"0\",\"2\":\"1\",\"3\":\"30.51346\",\"_rn_\":\"1\"},{\"1\":\"0\",\"2\":\"0\",\"3\":\"19.78372\",\"_rn_\":\"2\"},{\"1\":\"1\",\"2\":\"1\",\"3\":\"28.59107\",\"_rn_\":\"3\"},{\"1\":\"0\",\"2\":\"0\",\"3\":\"18.63635\",\"_rn_\":\"4\"},{\"1\":\"0\",\"2\":\"0\",\"3\":\"14.55074\",\"_rn_\":\"5\"},{\"1\":\"1\",\"2\":\"0\",\"3\":\"12.41954\",\"_rn_\":\"6\"}],\"options\":{\"columns\":{\"min\":{},\"max\":[10]},\"rows\":{\"min\":[10],\"max\":[10]},\"pages\":{}}}\n  </script>\n</div>\n`````\n:::\n\n```{.r .cell-code}\nglimpse(df)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n#> Rows: 10,000\n#> Columns: 3\n#> $ rand_enc   <int> 0, 0, 1, 0, 0, 1, 0, 0, 1, 0, 0, 0, 1, 1, 1, 1, 0, 0, 0, 0,…\n#> $ used_ftr   <int> 1, 0, 1, 0, 0, 0, 1, 0, 0, 0, 1, 0, 1, 0, 1, 1, 1, 0, 0, 0,…\n#> $ time_spent <dbl> 30.51346, 19.78372, 28.59107, 18.63635, 14.55074, 12.41954,…\n```\n:::\n\n```{.r .cell-code}\nsummary(df)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n#>     rand_enc         used_ftr       time_spent    \n#>  Min.   :0.0000   Min.   :0.000   Min.   :-1.625  \n#>  1st Qu.:0.0000   1st Qu.:0.000   1st Qu.:17.782  \n#>  Median :1.0000   Median :0.000   Median :22.869  \n#>  Mean   :0.5068   Mean   :0.408   Mean   :23.286  \n#>  3rd Qu.:1.0000   3rd Qu.:1.000   3rd Qu.:28.817  \n#>  Max.   :1.0000   Max.   :1.000   Max.   :47.948\n```\n:::\n:::\n\n1. Plot DAG\n\n::: {.cell hash='09_iv_cache/html/unnamed-chunk-3_9747bd332ccd641e250c3ce3a2e1da40'}\n\n```{.r .cell-code}\nApp_usuage <- dagify(\n  timespent ~ used_ftr,\n  used_ftr ~ rand_enc,\n  coords = list(x = c(timespent = 3,  used_ftr = 1, rand_enc = -1),\n                y = c(timespent = 0,  used_ftr = 0, rand_enc = 0))\n)\n# Plot DAG\nggdag(App_usuage, use_labels = \"name\", text =  F) + theme_dag()\n```\n\n::: {.cell-output-display}\n![](09_iv_files/figure-html/unnamed-chunk-3-1.png){width=672}\n:::\n:::\n\nFrom my understanding of these relationships from DAG, time spent would be the outcome which depends on the used new feature (used_ftr) would be the treatment variable and randomized encouragement trial (rand_enc) would be instrumental variable.\n\n2. Compute the naive, biased estimate.\n\n::: {.cell hash='09_iv_cache/html/unnamed-chunk-4_bef2bd184c7e4d564a4518faf151e30c'}\n\n```{.r .cell-code}\nmodel_biased <- lm(time_spent ~ used_ftr, data = df)\nsummary(model_biased)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n#> \n#> Call:\n#> lm(formula = time_spent ~ used_ftr, data = df)\n#> \n#> Residuals:\n#>      Min       1Q   Median       3Q      Max \n#> -20.4950  -3.5393   0.0158   3.5961  20.5051 \n#> \n#> Coefficients:\n#>             Estimate Std. Error t value Pr(>|t|)    \n#> (Intercept) 18.86993    0.06955   271.3   <2e-16 ***\n#> used_ftr    10.82269    0.10888    99.4   <2e-16 ***\n#> ---\n#> Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\n#> \n#> Residual standard error: 5.351 on 9998 degrees of freedom\n#> Multiple R-squared:  0.497,\tAdjusted R-squared:  0.497 \n#> F-statistic:  9881 on 1 and 9998 DF,  p-value: < 2.2e-16\n```\n:::\n:::\n\n::: {.cell hash='09_iv_cache/html/unnamed-chunk-5_14ae8dfafb2c1d0b4e0ea6663e597ff5'}\n\n```{.r .cell-code}\nmodel_naive <- lm(rand_enc ~ used_ftr, data = df)\nsummary(model_naive)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n#> \n#> Call:\n#> lm(formula = rand_enc ~ used_ftr, data = df)\n#> \n#> Residuals:\n#>     Min      1Q  Median      3Q     Max \n#> -0.6299 -0.4220  0.3701  0.3701  0.5780 \n#> \n#> Coefficients:\n#>             Estimate Std. Error t value Pr(>|t|)    \n#> (Intercept) 0.421959   0.006361   66.33   <2e-16 ***\n#> used_ftr    0.207943   0.009959   20.88   <2e-16 ***\n#> ---\n#> Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\n#> \n#> Residual standard error: 0.4894 on 9998 degrees of freedom\n#> Multiple R-squared:  0.04178,\tAdjusted R-squared:  0.04169 \n#> F-statistic:   436 on 1 and 9998 DF,  p-value: < 2.2e-16\n```\n:::\n:::\n",
    "supporting": [],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {
      "include-in-header": [
        "<link href=\"../../site_libs/pagedtable-1.1/css/pagedtable.css\" rel=\"stylesheet\" />\n<script src=\"../../site_libs/pagedtable-1.1/js/pagedtable.js\"></script>\n"
      ]
    },
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}